<script>
    const connectButton = document.getElementById('connectBtn');
    const output = document.getElementById('output');

    connectButton.addEventListener('click', async () => {
        output.innerText = "Attempting to connect...";
        try {
            const filters = [
                { vendorId: 0x0E8D, productId: 0x201C }, // Your device's VID and PID
                { vendorId: 0x18D1 }, // Google vendor ID (fallback)
            ];

            const device = await navigator.usb.requestDevice({ filters });

            // Open the device
            await device.open();
            output.innerText = `Device connected: ${device.productName}`;

            // List the available interfaces
            const interfaces = device.configuration.interfaces;
            output.innerText += '\nAvailable interfaces:';
            interfaces.forEach((interfaceInfo, index) => {
                output.innerText += `\nInterface ${index}: Class ${interfaceInfo.interfaceClass}, Subclass ${interfaceInfo.interfaceSubclass}`;
            });

            // Assuming interface 0 (just as a fallback; you might need to select the correct one)
            await device.selectConfiguration(1);

            // Now try to claim the interface
            await device.claimInterface(0); // Assuming interface 0, but adjust this based on actual interfaces
            output.innerText += '\nADB Interface claimed.';

            // Send a sample ADB command
            const adbCommand = new Uint8Array([0x48, 0x01, 0x00, 0x01, 0x01]); // Sample ADB command
            await device.transferOut(1, adbCommand); // Send command

            output.innerText += '\nADB command sent.';

            // Receive response
            const response = await device.transferIn(1, 64);
            output.innerText += '\nResponse received: ' + new TextDecoder().decode(response.data);

        } catch (error) {
            output.innerText = `Error: ${error.message}`;
        }
    });
</script>
